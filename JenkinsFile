pipeline {
	agent{
	  docker {
                  image 'abhishekf5/maven-abhishek-docker-agent:v1'
      // args '--user root -v /var/run/docker.sock:/var/run/docker.sock' // mount Docker socket to access the host's Docker daemon
    }
    }  

	  stages {
              stage('Build maven ') {
                   steps {      
                     sh 'mvn  clean install package'
                    }
                 }
        
              stage('Copy Artifact') {
                   steps { 
                
		     sh 'cp -r target/*.jar docker'
                    }
                 }
         
              
       // Uploading Docker images into dockerhub
	     stage('build and Pushing to dockerhub') {
		   steps{
		       script {
			       def customImage = docker.build('kavyapallamreddy/petclinic', "./docker")
                 	       docker.withRegistry('https://registry.hub.docker.com', 'dockerhub') {
                               customImage.push("${env.BUILD_NUMBER}")
			       }
			    }
			}
		  	 }
}
}
